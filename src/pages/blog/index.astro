---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

// 1. Fetch all blog posts from the "blog" collection
const posts = await getCollection('blog');

// 2. Sort them by date (Newest first)
posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout title="Journal Archive">
  <main class="pt-12 pb-16">
    
    <div class="text-center mb-12 space-y-4">
      <h1 class="text-4xl font-extrabold text-white tracking-tight">The Journal Archive</h1>
      <p class="text-slate-400 max-w-md mx-auto">
        Deep dives into the stories behind the shorts. Read the full scripts and historical context.
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      {posts.map((post) => (
        <a 
          href={`/blog/${post.slug}`} 
          class="group bg-slate-800 rounded-2xl overflow-hidden border border-slate-700 hover:border-amber-500/50 transition-all hover:shadow-2xl hover:shadow-amber-900/20 hover:-translate-y-1"
        >
          <div class="aspect-video overflow-hidden">
            <img 
              src={post.data.image} 
              alt={post.data.title} 
              class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
            />
          </div>

          <div class="p-6 space-y-3">
            <div class="flex items-center space-x-2 text-xs font-semibold text-amber-500 uppercase tracking-wider">
              <span>{post.data.pubDate.toLocaleDateString()}</span>
            </div>
            
            <h2 class="text-xl font-bold text-white leading-tight group-hover:text-amber-400 transition-colors">
              {post.data.title}
            </h2>
            
            <p class="text-slate-400 text-sm line-clamp-2">
              {post.data.description}
            </p>

            <span class="inline-block pt-2 text-sm font-bold text-slate-300 group-hover:text-white group-hover:underline decoration-amber-500 underline-offset-4">
              Read Story â†’
            </span>
          </div>
        </a>
      ))}
    </div>

    {posts.length === 0 && (
      <div class="text-center py-20 bg-slate-800/50 rounded-2xl border border-slate-700 border-dashed">
        <p class="text-slate-500">No entries found in the journal yet.</p>
      </div>
    )}

  </main>
</Layout>